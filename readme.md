# Repo Rangler: PHP Service (Satis)

This docker service will mimic a satis repository, but a lot more powerful and flexible.

# Installation

You should be able to resolve `php.reporangler.develop` locally on your computer. 
Maybe you need to edit `/etc/hosts` file or add to dns?

Run `docker-compose run --rm php_service_phpfpm`

Run `docker-compose run --rm -p 80:80 php_service_nginx`
    - the port is required to bind to your local `port 80`
    - if this doesn't work, check `port 80` to see if you have apache/nginx already running
    - these instructions are obviously simplified and expect `port 80` to be free
    
Check with `docker ps` to see if both containers are running

Run `curl -vvv http://php.reporangler.develop/healthz`
It should output
```
> GET /healthz HTTP/1.1
> Host: php.reporangler.develop
> User-Agent: curl/7.54.0
> Accept: */*
> 
< HTTP/1.1 200 OK
< Server: nginx/1.16.0
< Content-Type: application/json
< Transfer-Encoding: chunked
< Connection: keep-alive
< X-Powered-By: PHP/7.3.4
< Cache-Control: no-cache, private
< Date: Sat, 31 Aug 2019 17:32:06 GMT
< Access-Control-Allow-Origin: *.reporangler.develop
< Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS
< Access-Control-Allow-Credentials: true
< Access-Control-Allow-Headers: *
< 
* Connection #0 to host php.reporangler.develop left intact
{"statusCode":200}
```

# Usage

Replace the file '`all$12341234.json`' with one generated by satis and composer should read it without any problems.

Once you've done that, try this:
```
composer show --all your-vendor/*
``` 

It should return this:
```
available:
  your-vendor/the-package-name A library that won't work because it's fake
```

If you want to check with your own satis packages. You can replace this file with your own.
As long as the files are coming from gitlab or github, it should install everything fine.

I've run this against my own packages hosted on github and everything was hunky dory.

# Future Ideas 

Obviously repositories which rely on locally cached, or stored files, won't work. Because this project will not know how to serve them.

# Notes

I realised that in order to make this run through a database, I just have to mimic the packages.json file and accept 
any request in the `/include/` prefixed location and return a result and composer will be happy. 

So this makes things a lot easier when wanting to return a custom list of packages based on an authorised or public user 
